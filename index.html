<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>CONTRAAAST…Color Contrast Confabulator</title><style>*{ } :root{ interpolate-size: allow-keywords; color-scheme: light dark; --color-1: #000000; --color-2: #ffffff; --measure: 100ch; --type-family-mono: ui-monospace, monospace; --type-scale-body: clamp(0.95rem, 0.8286rem + 0.6071vw, 1.375rem); --type-scale-display: clamp(1.75rem, 0.25rem + 7.5vw, 7rem); --type-scale-functional: clamp(0.75rem, 0.6964rem + 0.2679vw, 0.9375rem); --type-leading-tight: 1; --type-leading-open: clamp(1.4, 1.4 + 0.2 * (100vw - 320px) / 1120px, 1.6); --type-tracking-slight: 0.010ch; --type-tracking-tight: -0.050ch; --type-tracking-tight-0: calc(var(--type-tracking-tight) * (1 - min(1, (100vw - 320px) / 1120px))); --type-weight-500: 500; --type-weight-700: 700; --space-4: 0.25rem; --space-8: 0.5rem; --space-12: 0.75rem; --space-24: 1.5rem; --space-32: 2rem; --space-0-4: clamp(0rem, -0.0714rem + 0.3571vw, 0.25rem); --space-8-12: clamp(0.5rem, 0.4286rem + 0.3571vw, 0.75rem); --space-12-16: clamp(0.75rem, 0.6786rem + 0.3571vw, 1rem); --space-12-24: clamp(0.75rem, 0.5357rem + 1.0714vw, 1.5rem); --space-12-32: clamp(0.75rem, 0.3929rem + 1.7857vw, 2rem); --space-12-8: clamp(0.5rem, 0.8214rem - 0.3571vw, 0.75rem); --space-16-12: clamp(0.75rem, 1.0714rem - 0.3571vw, 1rem); --space-20-16: clamp(1rem, 1.3214rem - 0.3571vw, 1.25rem); --corner: 0.5em; --dashed-line-thin: clamp(0.0625rem, 0.0446rem + 0.0893vw, 0.125rem) dashed currentColor; --dashed-line-thick: clamp(0.375rem, 0.3036rem + 0.3571vw, 0.625rem) dashed currentColor; --shadow-color: 219 3% 15%; --shadow-strength: 1%; --shadow: 0 -1px 2px 0 hsl(var(--shadow-color) / calc(var(--shadow-strength) + 2%)), 0 2px 1px -2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 3%)), 0 5px 5px -2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 3%)), 0 10px 10px -2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 4%)), 0 20px 20px -2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 5%)), 0 40px 40px -2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 7%)); --duration-1: 240ms; --duration-2: 360ms; --duration-3: 420ms; --ease-in-out-quadratic: cubic-bezier(0.455, 0.03, 0.515, 0.955);} *, *::before, *::after{ background-color: inherit; color: inherit; box-sizing: border-box; margin: 0; padding: 0;} html{ font-size: 100%; min-block-size: 100dvh; text-size-adjust: none; -moz-text-size-adjust: none; -webkit-text-size-adjust: none;} body{ color: var(--color-1); background-color: var(--color-2); border-block: var(--dashed-line-thick); font-family: var(--type-family-mono); line-height: var(--type-leading-open); min-block-size: 100dvh;} a{ text-decoration-thickness: .15ex; text-underline-offset: .25ex;} :is(a:hover, a:focus){ text-underline-offset: .35ex;} a:active{ text-decoration-style: dashed; text-decoration-thickness: .2ex;} h1{ font-size: var(--type-scale-body); letter-spacing: var(--type-tracking-slight);} h1 a{ text-decoration: none;} h1 span{ color: var(--color-2); background-color: var(--color-1);} h2, h4{ font-size: var(--type-scale-functional); font-weight: var(--type-weight-500); letter-spacing: var(--type-tracking-slight); text-transform: uppercase;} h3{ font-size: var(--type-scale-body);} p{ font-size: var(--type-scale-body); -webkit-hyphens: auto; -webkit-hyphenate-limit-before: 3; -webkit-hyphenate-limit-after: 3; -webkit-hyphenate-limit-chars: 6 3 3; -webkit-hyphenate-limit-lines: 2; -webkit-hyphenate-limit-last: always; -webkit-hyphenate-limit-zone: 8%; hyphens: auto; hyphenate-limit-chars: 6 3 3; hyphenate-limit-lines: 2; hyphenate-limit-last: always; hyphenate-limit-zone: 8%;} small{ font-size: var(--type-scale-functional); letter-spacing: var(--type-tracking-tight);} output{ font-size: var(--type-scale-display); font-weight: var(--type-weight-700); line-height: var(--type-leading-tight); letter-spacing: var(--type-tracking-tight-0); overflow-x: scroll; pointer-events: none;} main section:nth-of-type(1){ text-align: right;} main section:nth-of-type(2){ text-align: center;} main section:nth-of-type(3){ text-align: left;} button{ display: inline-flex; justify-content: center; border: 2px solid currentColor; border-radius: var(--corner); padding-block: var(--space-12-16); padding-inline: var(--space-16-12); direction: rtl; font: inherit; font-size: var(--type-scale-body); font-weight: var(--type-weight-700); line-height: var(--type-leading-tight); text-wrap: nowrap; cursor: pointer; overflow: clip;} button:is(:focus, :active){ outline: var(--dashed-line-thin);} button:focus{ outline-offset: 2px;} button:active{ outline-offset: -6px;} .btn-icon{ background-color: transparent; border: none; padding: 0; margin-inline: 0;} .btn-icon:is(:focus, :active){ outline-offset: 1px;} .btn-icon:active{ outline-offset: 0;} .btn-icon .icon{ transform: scale(1); transition: transform var(--duration-3) var(--ease-in-out-quadratic);} .btn-icon:hover .icon{ transform: scale(1.1); transition-duration: var(--duration-1);} .btn-action .icon{ opacity: .6; transform: scale(1); transition: opacity var(--duration-3) var(--ease-in-out-quadratic), transform var(--duration-3) var(--ease-in-out-quadratic); animation: none; } .btn-action:hover .icon{ opacity: 1; transform: scale(1.05); transition-duration: var(--duration-1); animation: beat var(--duration-2) var(--ease-in-out-quadratic) infinite;} .icon-fade-out, .icon-fade-in{ transition-property: opacity; transition-timing-function: var(--ease-in-out-quadratic);} .icon-fade-out{ transition-duration: var(--duration-1); opacity: 0;} .icon-fade-in{ transition-duration: 360ms; opacity: 1;} dialog{ border-block: var(--dashed-line-thick); border-inline: none; box-shadow: var(--shadow); margin-block: auto !important; padding-block: var(--space-16-12) var(--space-12-24); padding-inline: var(--space-12-32);} dialog::backdrop{ } dialog[open], dialog[open]::backdrop{ animation-duration: var(--duration-3); animation-timing-function: var(--ease-in-out-quadratic); animation-fill-mode: forwards;} dialog[open]{ animation-name: fade-in;} dialog[open]::backdrop{ animation-name: fade-in-backdrop;} .center{ box-sizing: content-box; margin-inline: auto; max-inline-size: var(--measure);} .cover{ display: flex; flex-direction: column; min-block-size: 100vh; padding-block: var(--space-12-8) var(--space-0-4); padding-inline: var(--space-8-12);} .cover>*{ margin-block: var(--space-12-16);} .cover>:first-child:not(main){ margin-block-start: 0;} .cover>:last-child:not(main){ margin-block-end: 0;} .cover>main{ margin-block: auto;} .with-icon{ display: inline-flex; align-items: center;} .icon{ height: 2.6cap; width: 2.6cap;} .with-icon .icon{ margin-inline-end: var(--space-12);} .stack-x{ display: flex; flex-wrap: wrap; gap: var(--space-8); justify-content: space-between; align-items: center;} [class^='stack-y']{ display: flex; flex-direction: column; justify-content: flex-start;} [class^='stack-y']>*{ margin-block: 0;} .stack-y-4>*+*{ margin-block-start: var(--space-4);} .stack-y-8>*+*{ margin-block-start: var(--space-8)} .stack-y-24>*+*{ margin-block-start: var(--space-24);} .stack-y-32>*+*{ margin-block-start: var(--space-32);} .switcher{ display: flex; flex-wrap: wrap; gap: var(--space-12-16);} .switcher>*{ --measure: 50rem; flex-grow: 1; flex-basis: calc((var(--measure) - 100%) * 999);} .switcher>:nth-last-child(n+ 4), .switcher>:nth-last-child(n+ 4)~*{ flex-basis: 100%;} main.switcher{ gap: var(--space-20-16);} .cr{ display: flex; flex-grow: 1; align-items: center; justify-content: center; margin-block: auto;} .jcfe{ justify-content: flex-end;} .jcsa{ justify-content: space-around;} .mi0{ margin-inline: 0 !important;} .mi4{ margin-inline: var(--space-4);} .sc{ font-variant-caps: all-small-caps; letter-spacing: var(--type-tracking-slight);} .vh{ position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;} @keyframes beat{ 0%, 100%{ transform: scale(1);} 50%{ transform: scale(1.2);}} @keyframes fade-in{ 0%{ opacity: 0; display: none;} 100%{ opacity: 1.0; display: block;}} @keyframes fade-in-backdrop{ 0%{ background-color: hsla(0, 0%, 0%, 0); } 100%{ background-color: hsla(0, 0%, 0%, 0.35); }} @media (prefers-reduced-motion: reduce){ *, ::after, ::before{ animation-duration: 0s !important; animation-iteration-count: 1 !important; transition-duration: 0s !important; scroll-behavior: auto !important;}} @media screen and (max-width: 50rem){ main section:nth-of-type(n+1){ text-align: center;} main section:nth-of-type(1){ order: 1;} main section:nth-of-type(2){ order: 3;} main section:nth-of-type(3){ order: 2;} footer button:nth-of-type(1){ order: 2;} footer button:nth-of-type(2){ order: 3;} footer button:nth-of-type(3){ order: 1;} .with-icon{ justify-content: space-between;} .cr{ align-items: normal; flex-grow: 0; margin-block: 0;} #ratio{ margin-block-start: var(--space-8);} :where(#color1, #color2){ text-wrap: nowrap;}} </style><meta name="theme-color" content="#000000" /><meta name="description" content="CONTRAAAST…WCAG AAA color-pair generator"><meta name="author" content="Timothy Martens"></head><body class="cover"><header class="stack-x"><h1><a href="" title="CONTRAAAST…WCAG AAA Color-pair Generator">CONTR<span>AAA</span>ST</a></h1><button id="info" class="btn-icon with-icon" aria-label="Information about CONTRAAAST"><svg class="icon mi0" aria-hidden="true"><use href="#icon-info"></use></svg><span class="vh">Info</span></button></header><main class="switcher"><section class="stack-y-8"><label for="color1"><h2>Foreground Color</h2></label><output name="color1" id="color1" aria-live="polite"></output></section><section class="stack-y-8"><label for="ratio"><h2>Contrast Ratio</h2></label><div class="cr"><output name="ratio" id="ratio" aria-live="polite"></output></div></section><section class="stack-y-8"><label for="color2"><h2>Background Color</h2></label><output name="color2" id="color2" aria-live="polite"></output></section></main><footer class="stack-y-32"><section class="switcher"><button id="invert" class="btn-action with-icon" aria-label="Swap foreground and background colors"><svg class="icon" aria-hidden="true"><use href="#icon-swap"></use></svg>Swap </button><button id="run" class="btn-action with-icon" aria-label="Generate a new color-pair"><svg class="icon" aria-hidden="true"><use href="#icon-color"></use></svg>Color Me </button><button id="copy" class="btn-action with-icon" aria-label="Get the CSS for this color-pair"><svg class="icon" aria-hidden="true"><use href="#icon-copy"></use></svg>Copy </button></section><section class="stack-x"><small><span class="sc">AAA</span>color-pairs</small><small>7&#8210;21</small><small>&copy;&apos;25 <a href="https://timpish.com">Timothy Martens</a></small></section></footer><dialog id="dialog" role="dialog" class="center"><section class="stack-y-24"><header class="stack-x"><h3>About</h3><button id="close" class="btn-icon with-icon" aria-label="Close information dialog"><svg class="icon mi0" aria-hidden="true"><use href="#icon-close"></use></svg><span class="vh">Close</span></button></header><p>CONTRAAAST generates random <abbr title="Oklab Lightness, Chroma, Hue" class="sc">OKLCH</abbr>color theme pairs compliant with <abbr title="Web Content Accessibility Guidelines" class="sc">WCAG</abbr><a href="https://www.w3.org/WAI/WCAG21/Understanding/contrast-enhanced.html" target="_blank">Success Criterion 1.4.6</a>. Level AAA color contrast ratios range from 7&ratio;1 to 21&ratio;1. Black<span class="mi4">&harr;</span>White have the maximum contrast ratio of 21&ratio;1.</p><section class="stack-x jcsa"><div class="stack-y-4"><h4>High Score</h4><output id="high-score" aria-live="polite"></output></div><div class="stack-y-4"><h4>&numero; of Runs</h4><output id="no-of-runs" aria-live="polite"></output></div></section><p>Did you hit Blackjack/21? Post your high score and favorite colors-pairs on <a href="https://www.linkedin.com/in/timothyfmartens/">LinkedIn</a>!</p><small class="stack-x jcfe"><span>Looking for <a href="https://contraaast.timpish.com/v1">Version 1</a>?</span></small></section></dialog><svg class="vh" display="none" aria-hidden=”true” height="0" width="0" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="icon-info" title="Information Icon" viewBox="0 0 256 256"><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" /><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M120 120a8 8 0 0 1 8 8v40a8 8 0 0 0 8 8" /><circle cx="124" cy="84" r="12" fill="currentColor" /></symbol><symbol id="icon-close" title="Close Icon" viewBox="0 0 256 256"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M200 56 56 200m144 0L56 56" /></symbol><symbol id="icon-swap" title="Swap Colors Icon" viewBox="0 0 256 256"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M80 160h128a8 8 0 0 0 8-8V48a8 8 0 0 0-8-8H96a8 8 0 0 0-8 8v8" /><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="m104 136-24 24 24 24" /><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M176 96H48a8 8 0 0 0-8 8v104a8 8 0 0 0 8 8h112a8 8 0 0 0 8-8v-8" /><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="m152 120 24-24-24-24" /></symbol><symbol id="icon-color" title="Generate Color-Pair Icon" viewBox="0 0 256 256"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M128 192a24 24 0 0 1 24-24h46.21a24 24 0 0 0 23.4-18.65 96.48 96.48 0 0 0 2.39-22.18c-.45-52.82-44.16-95.7-97-95.17a96 96 0 0 0-95 96c0 41.81 26.73 73.44 64 86.61A24 24 0 0 0 128 192Z" /><circle cx="128" cy="76" r="12" fill="currentColor" /><circle cx="84" cy="100" r="12" fill="currentColor" /><circle cx="84" cy="156" r="12" fill="currentColor" /><circle cx="172" cy="100" r="12" fill="currentColor" /></symbol><symbol id="icon-copy" title="Copy CSS Code Icon" viewBox="0 0 256 256"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M168 168h48V40H88v48" /><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="M40 88h128v128H40z" /></symbol><symbol id="icon-check" title="Confirm Copy CSS Code Check Icon" viewBox="0 0 256 256"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" d="m40 144 56 56L224 72" /></symbol></defs></svg><script>// Constants const WCAG_AAA_MIN_CONTRAST=7.0; const MAX_CONTRAST=21.0; const STORAGE_KEY='contraaastStats'; // State tracking with default values let currentStats={ runs: 0, highScore: 0}; // Cache DOM Elements const elements={ color1: document.getElementById('color1'), color2: document.getElementById('color2'), ratio: document.getElementById('ratio'), invertBtn: document.getElementById('invert'), runBtn: document.getElementById('run'), copyBtn: document.getElementById('copy'), noOfRuns: document.getElementById('no-of-runs'), highScore: document.getElementById('high-score'), showBtn: document.getElementById("info"), closeBtn: document.getElementById("close"), dialog: document.getElementById("dialog"), titleSpan: document.querySelector("h1 span")}; // Cache canvas context for color calculations const colorCanvas=document.createElement('canvas'); colorCanvas.width=1; colorCanvas.height=1; const colorCtx=colorCanvas.getContext('2d'); function loadStats(){ try{ const savedStats=localStorage.getItem(STORAGE_KEY); if (savedStats){ currentStats=JSON.parse(savedStats); updateStatsDisplay();}} catch (e){ console.error("Error parsing saved stats:", e); saveStats(); // Overwrite corrupted data}} function saveStats(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(currentStats)); updateStatsDisplay();} catch (e){ console.error("Error saving stats:", e);}} function updateStatsDisplay(){ if (elements.noOfRuns && elements.highScore){ elements.noOfRuns.textContent=currentStats.runs.toLocaleString(); // Special formatting for maximum score of 21 if (currentStats.highScore >=21){ elements.highScore.textContent="21!";} else{ elements.highScore.textContent=currentStats.highScore.toFixed(1);}}} function oklchToHex(oklchColor){ try{ colorCtx.fillStyle=oklchColor; colorCtx.fillRect(0, 0, 1, 1); const imageData=colorCtx.getImageData(0, 0, 1, 1).data; return `#${byteToHex(imageData[0])}${byteToHex(imageData[1])}${byteToHex(imageData[2])}`;} catch (e){ console.error("Error converting OKLCH to hex:", e); return "#000000"; // Fallback to black}} function byteToHex(value){ return ('0' + (value || 0).toString(16)).slice(-2);} function parseOklch(oklchStr){ try{ const matches=oklchStr.match(/oklch\(([0-9.]+)\s+([0-9.]+)\s+([0-9]+)/); if (!matches || matches.length < 4){ console.error("Could not parse OKLCH color:", oklchStr); return{ l: 0.5, c: 0.1, h: 0};} return{ l: parseFloat(matches[1]) || 0.5, c: parseFloat(matches[2]) || 0.1, h: parseInt(matches[3]) || 0};} catch (e){ console.error("Error parsing OKLCH:", e); return{ l: 0.5, c: 0.1, h: 0};}} function formatOklch(l, c, h){ // Ensure values are within reasonable ranges const safeL=Math.max(0, Math.min(1, l || 0.5)); const safeC=Math.max(0, c || 0.1); const safeH=Math.max(0, Math.min(360, h || 0)); return `oklch(${safeL.toFixed(2)} ${safeC.toFixed(4)} ${safeH.toFixed(2)})`;} function formatOklchDisplay(oklchStr){ const{ l, c, h}=parseOklch(oklchStr); return `${l.toFixed(2)} ${c.toFixed(4)} ${h.toFixed(2)}`;} function calculateContrastRatio(color1, color2){ try{ // Get luminance for each color const lum1=getLuminance(color1); const lum2=getLuminance(color2); // Calculate contrast ratio return lum1 >lum2 ? (lum1 + 0.05) / (lum2 + 0.05) : (lum2 + 0.05) / (lum1 + 0.05);} catch (e){ console.error("Error calculating contrast ratio:", e); return WCAG_AAA_MIN_CONTRAST; // Return minimum acceptable contrast}} function getLuminance(color){ try{ colorCtx.fillStyle=color; colorCtx.fillRect(0, 0, 1, 1); const [r, g, b]=colorCtx.getImageData(0, 0, 1, 1).data; // Convert RGB to sRGB const R=srgbToLinear(r / 255); const G=srgbToLinear(g / 255); const B=srgbToLinear(b / 255); // WCAG relative luminance formula return 0.2126 * R + 0.7152 * G + 0.0722 * B;} catch (e){ console.error("Error getting luminance:", e); return 0.5; // Return middle luminance as fallback}} function srgbToLinear(value){ value=Math.max(0, Math.min(1, value || 0)); return value <=0.03928 ? value / 12.92 : Math.pow((value + 0.055) / 1.055, 2.4);} function initializeWithDefaultColors(){ const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches; // Set colors based on color scheme preference const foreground=prefersDark ? 'oklch(1 0 0)' : 'oklch(0 0 0)'; // White : Black const background=prefersDark ? 'oklch(0 0 0)' : 'oklch(1 0 0)'; // Black : White updateUIWithColors(foreground, background, MAX_CONTRAST);} function updateUIWithColors(foreground, background, contrastRatio){ // Update output displays with formatted values if (elements.color1) elements.color1.textContent=formatOklchDisplay(foreground); if (elements.color2) elements.color2.textContent=formatOklchDisplay(background); if (elements.ratio) elements.ratio.textContent=contrastRatio.toFixed(1); // Apply colors to CSS variables instead of inline styles document.documentElement.style.setProperty('--color-1', foreground); document.documentElement.style.setProperty('--color-2', background);} function randomInRange(min, max){ min=Number(min) || 0; max=Number(max) || 1; return min + Math.random() * (max - min);} function generateRandomOklchColor(){ // Random lightness, chroma, and hue const l=randomInRange(0.1, 0.9); const c=randomInRange(0.02, 0.2); // Lower chroma for more natural colors const h=Math.floor(Math.random() * 360); return formatOklch(l, c, h);} function generateOklchWithLightness(l){ // Random chroma (saturation) and hue const c=randomInRange(0.02, 0.2); const h=Math.floor(Math.random() * 360); return formatOklch(l, c, h);} function generateDiverseColorPair(targetMinContrast, targetMaxContrast, attempts=50){ let bestPair=null; let bestContrast=0; // Ensure valid contrast range targetMinContrast=Math.max(WCAG_AAA_MIN_CONTRAST, Number(targetMinContrast) || WCAG_AAA_MIN_CONTRAST); targetMaxContrast=Math.min(MAX_CONTRAST, Number(targetMaxContrast) || MAX_CONTRAST); attempts=Math.min(100, Math.max(10, Number(attempts) || 50)); for (let i=0; i < attempts; i++){ // Generate completely random colors const color1=generateRandomOklchColor(); const color2=generateRandomOklchColor(); // Calculate contrast const contrast=calculateContrastRatio(color1, color2); // Check if it's within our desired range if (contrast >=targetMinContrast && contrast <=targetMaxContrast){ // If it's in range, we can potentially return immediately // but let's continue looking for more variety if attempts is high if (Math.random() < 0.2){ // 20% chance of immediate return if valid return{ foreground: color1, background: color2, ratio: contrast};} else if (contrast >bestContrast){ bestPair={ foreground: color1, background: color2, ratio: contrast}; bestContrast=contrast;}}} // If we found a valid pair, return it if (bestPair !==null){ return bestPair;} // If we didn't find a valid pair after all attempts, use fallback strategy return generateOptimizedContrastPair( randomInRange(targetMinContrast, targetMaxContrast) );} function generateOptimizedContrastPair(targetRatio){ // Ensure valid target ratio targetRatio=Math.max(WCAG_AAA_MIN_CONTRAST, Math.min(MAX_CONTRAST, Number(targetRatio) || WCAG_AAA_MIN_CONTRAST)); // Generate first color with random lightness const l1=randomInRange(0.1, 0.9); const color1=generateOklchWithLightness(l1); // Determine if second color should be lighter or darker const needsLight=l1 < 0.5; // Estimate the lightness needed for target contrast let l2Base; if (needsLight){ // First color is dark, make second color lighter l2Base=randomInRange(0.7, 0.95);} else{ // First color is light, make second color darker l2Base=randomInRange(0.05, 0.3);} // Generate second color with this lightness const color2=generateOklchWithLightness(l2Base); // Calculate actual contrast let actualRatio=calculateContrastRatio(color1, color2); // Fine-tune the lightness of the second color to get closer to target return finetuneContrast(color1, color2, targetRatio, actualRatio);} function finetuneContrast(color1, color2, targetRatio, currentRatio){ const c1=parseOklch(color1); // Parse the first color into OKLCH components const c2=parseOklch(color2); // Parse the second color into OKLCH components // Maximum number of attempts to fine-tune the contrast const maxAttempts=15; let attempts=0; // Define an acceptable deviation from the target contrast ratio const tolerance=0.15; // Adjust the lightness of one color until the contrast ratio is close to the target while (Math.abs(currentRatio - targetRatio) >tolerance && attempts < maxAttempts && currentRatio >=WCAG_AAA_MIN_CONTRAST && currentRatio <=MAX_CONTRAST){ attempts++; // Choose the second color (c2) as the one to adjust let toAdjust=c2; // Calculate how much to adjust the lightness const adjustmentFactor=Math.min(0.05, Math.abs(currentRatio - targetRatio) / 20); if (currentRatio < targetRatio){ // If the current contrast is too low, increase the contrast if (c1.l < c2.l){ // If color1 is darker, make color2 lighter toAdjust.l=Math.min(0.98, toAdjust.l + adjustmentFactor);} else{ // If color1 is lighter, make color2 darker toAdjust.l=Math.max(0.02, toAdjust.l - adjustmentFactor);}} else{ // If the current contrast is too high, decrease the contrast if (c1.l < c2.l){ // If color1 is darker, make color2 darker toAdjust.l=Math.max(c1.l + 0.1, toAdjust.l - adjustmentFactor);} else{ // If color1 is lighter, make color2 lighter toAdjust.l=Math.min(c1.l - 0.1, toAdjust.l + adjustmentFactor);}} // Update color2 with the adjusted lightness const adjustedColor2=formatOklch(toAdjust.l, toAdjust.c, toAdjust.h); // Recalculate the contrast ratio with the adjusted color const newRatio=calculateContrastRatio(color1, adjustedColor2); // If the adjustment improved the contrast, keep it if (Math.abs(newRatio - targetRatio) < Math.abs(currentRatio - targetRatio) && newRatio >=WCAG_AAA_MIN_CONTRAST && newRatio <=MAX_CONTRAST){ color2=adjustedColor2; currentRatio=newRatio;} else{ // If the adjustment made things worse, stop further adjustments break;}} // Verify the final contrast ratio is within the acceptable range const finalRatio=calculateContrastRatio(color1, color2); // If the final contrast ratio is invalid, fall back to a simpler strategy if (finalRatio < WCAG_AAA_MIN_CONTRAST || finalRatio >MAX_CONTRAST){ return generateFallbackContrastPair();} return{ foreground: color1, background: color2, ratio: finalRatio};} function generateFallbackContrastPair(){ // Create high contrast pair based on color theory // Dark cool color and light warm color OR vice versa // Decide cool/warm orientation const useCoolDark=Math.random() >0.5; let foreground, background; if (useCoolDark){ // Dark blue/purple (cool) on light yellow/orange (warm) const coolHue=randomInRange(180, 300); // Blue to purple range const warmHue=randomInRange(20, 80); // Yellow to orange range foreground=formatOklch( randomInRange(0.1, 0.3), // Dark randomInRange(0.05, 0.15), // Moderate chroma coolHue ); background=formatOklch( randomInRange(0.7, 0.9), // Light randomInRange(0.05, 0.15), // Moderate chroma warmHue );} else{ // Dark yellow/orange (warm) on light blue/purple (cool) const coolHue=randomInRange(180, 300); // Blue to purple range const warmHue=randomInRange(20, 80); // Yellow to orange range foreground=formatOklch( randomInRange(0.1, 0.3), // Dark randomInRange(0.05, 0.15), // Moderate chroma warmHue ); background=formatOklch( randomInRange(0.7, 0.9), // Light randomInRange(0.05, 0.15), // Moderate chroma coolHue );} const ratio=calculateContrastRatio(foreground, background); // Validation step: Ensure the contrast ratio is within the acceptable range if (ratio < WCAG_AAA_MIN_CONTRAST || ratio >MAX_CONTRAST){ console.warn("Fallback strategy failed to generate valid contrast, retrying..."); return generateFallbackContrastPair(); // Retry until a valid pair is generated} return{ foreground, background, ratio};} function generateColorPair(){ // Define contrast ranges to ensure good distribution across the entire 7.0-21.0 range const contrastRanges=[ { min: 7.0, max: 10.0}, // Lower range { min: 10.0, max: 13.0}, // Mid-low range { min: 13.0, max: 17.0}, // Mid-high range { min: 17.0, max: 21.0} // High range ]; // Randomly select one of the contrast ranges const selectedRange=contrastRanges[Math.floor(Math.random() * contrastRanges.length)]; try{ // Use two different strategies to generate color pairs for variety const useDirectStrategy=Math.random() >0.5; if (useDirectStrategy){ // Strategy 1: Generate completely random colors and filter for contrast const colorPair=generateDiverseColorPair(selectedRange.min, selectedRange.max); // Verify the generated pair is within the required contrast range if (colorPair.ratio < WCAG_AAA_MIN_CONTRAST || colorPair.ratio >MAX_CONTRAST){ console.warn("Direct strategy failed to generate valid contrast, using fallback"); return generateFallbackContrastPair();} return colorPair;} else{ // Strategy 2: Generate colors by calculating lightness for a target contrast const targetRatio=randomInRange(selectedRange.min, selectedRange.max); const colorPair=generateOptimizedContrastPair(targetRatio); // Verify the generated pair is within the required contrast range if (colorPair.ratio < WCAG_AAA_MIN_CONTRAST || colorPair.ratio >MAX_CONTRAST){ console.warn("Optimized strategy failed to generate valid contrast, using fallback"); return generateFallbackContrastPair();} return colorPair;}} catch (e){ // If an error occurs, fall back to a simpler generation strategy console.error("Error generating color pair:", e); return generateFallbackContrastPair();}} function updateColorDisplay(colorPair){ if (!colorPair){ console.error("No color pair provided to updateColorDisplay"); return;} // Update UI with the color pair updateUIWithColors(colorPair.foreground, colorPair.background, colorPair.ratio); // Update stats currentStats.runs++; // Check if we have a new high score if (colorPair.ratio >currentStats.highScore){ // Cap the high score at 21.0 currentStats.highScore=Math.min(colorPair.ratio, 21.0); // Special logging for max score if (colorPair.ratio >=21.0){ console.log("MAXIMUM SCORE: 21!!!");} else{ console.log(`New high score: ${colorPair.ratio.toFixed(1)}!`);}} saveStats();} function swapColors(){ // Get current colors from CSS variables const foregroundStr=getComputedStyle(document.documentElement).getPropertyValue('--color-1').trim(); const backgroundStr=getComputedStyle(document.documentElement).getPropertyValue('--color-2').trim(); if (!foregroundStr || !backgroundStr){ const fgDisplay=elements.color1?.textContent; const bgDisplay=elements.color2?.textContent; if (!fgDisplay || !bgDisplay){ console.error("Could not get color values for swapping"); return;} // Parse values to reconstruct OKLCH strings const [fgL, fgC, fgH]=fgDisplay.split(' '); const [bgL, bgC, bgH]=bgDisplay.split(' '); const foreground=`oklch(${fgL} ${fgC} ${fgH})`; const background=`oklch(${bgL} ${bgC} ${bgH})`; // Get current contrast ratio const ratio=parseFloat(elements.ratio?.textContent || "7.0"); // Update UI with swapped colors updateUIWithColors(background, foreground, ratio);} else{ // Get current contrast ratio const ratio=parseFloat(elements.ratio?.textContent || "7.0"); // Update UI with swapped colors updateUIWithColors(backgroundStr, foregroundStr, ratio);}} function copyColorInfo(){ try{ // Get current foreground and background from CSS variables const foregroundStr=getComputedStyle(document.documentElement).getPropertyValue('--color-1').trim(); const backgroundStr=getComputedStyle(document.documentElement).getPropertyValue('--color-2').trim(); const ratio=elements.ratio?.textContent; let foreground, background; if (!foregroundStr || !backgroundStr){ // Fallback to display values const fgDisplay=elements.color1?.textContent; const bgDisplay=elements.color2?.textContent; if (!fgDisplay || !bgDisplay){ console.error("Could not get color values for copying"); return;} // Parse values to reconstruct OKLCH strings const [fgL, fgC, fgH]=fgDisplay.split(' '); const [bgL, bgC, bgH]=bgDisplay.split(' '); foreground=`oklch(${fgL} ${fgC} ${fgH})`; background=`oklch(${bgL} ${bgC} ${bgH})`;} else{ foreground=foregroundStr; background=backgroundStr;} // Generate HEX fallbacks const foregroundHex=oklchToHex(foreground); const backgroundHex=oklchToHex(background); // Format CSS variables for copying const cssText=`:where(html){ --_color-foreground: var(--color-1, ${foreground}, ${foregroundHex}); --_color-background: var(--color-2, ${background}, ${backgroundHex})}`; // Copy to clipboard and show feedback with elegant fade transition navigator.clipboard.writeText(cssText) .then(()=>{ // Show check icon temporarily with fade transition const copyIcon=elements.copyBtn?.querySelector("use"); if (copyIcon){ const originalXlink=copyIcon.getAttribute("href"); // Start fade out copyIcon.classList.add('icon-fade-out'); // After fade out completes, change the icon and fade back in setTimeout(()=>{ copyIcon.setAttribute("href", "#icon-check"); copyIcon.classList.remove('icon-fade-out'); copyIcon.classList.add('icon-fade-in'); // Reset back to original after displaying check setTimeout(()=>{ // Start fade out again copyIcon.classList.remove('icon-fade-in'); copyIcon.classList.add('icon-fade-out'); // After fade out, change back to original and fade in setTimeout(()=>{ copyIcon.setAttribute("href", originalXlink); copyIcon.classList.remove('icon-fade-out'); copyIcon.classList.add('icon-fade-in'); // Clean up classes after animation completes setTimeout(()=>{ copyIcon.classList.remove('icon-fade-in');}, 360);}, 240);}, 1000); // Show checkmark for 1 second}, 240);}}) .catch(err=>{ console.error("Failed to copy text: ", err);});} catch (e){ console.error("Error copying color info:", e);}} function initialize(){ try{ // Load stats first loadStats(); // Set up event listeners if (elements.invertBtn){ elements.invertBtn.addEventListener('click', swapColors);} if (elements.runBtn){ elements.runBtn.addEventListener('click', ()=>{ const colorPair=generateColorPair(); updateColorDisplay(colorPair);});} if (elements.copyBtn){ elements.copyBtn.addEventListener('click', copyColorInfo);} // Dialog event listeners if (elements.showBtn && elements.dialog){ elements.showBtn.addEventListener("click", ()=>{ elements.dialog.showModal();});} if (elements.closeBtn && elements.dialog){ elements.closeBtn.addEventListener("click", ()=>{ elements.dialog.close();});} // Set up system color scheme listener window.matchMedia('(prefers-color-scheme: dark)') .addEventListener('change', initializeWithDefaultColors); // Initialize with default colors initializeWithDefaultColors();} catch (e){ console.error("Error initializing application:", e);}} // Initialize app when DOM is loaded if (document.readyState==='interactive' || document.readyState==='complete'){ initialize();} else{ document.addEventListener('DOMContentLoaded', initialize);} </script></body></html>